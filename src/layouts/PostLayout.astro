---
import { format } from "@formkit/tempo";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";
import { ClientRouter } from "astro:transitions";
import PostCard from "../components/PostCard.astro";
import { Image } from "astro:assets";

type Props = {
    title: string;
    date: string;
    description: string;
    relatedPosts?: string[];
};

const { title, date, description } = Astro.props;
const { href } = Astro.url;

const relatedPosts =
    Astro.props.relatedPosts && Astro.props.relatedPosts.length > 0
        ? await getCollection("blog").then((posts) =>
              posts.filter((post) =>
                  Astro.props.relatedPosts!.includes(post.id),
              ),
          )
        : [];
---

<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />
        <meta name="description" content={description} />
        <meta name="author" content="Avilio Muñoz Vilchez" />
        <meta
            name="keywords"
            content="blog, personal, avilio, muñoz, economista, abogado, ciencia, investigación"
        />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:type" content="article" />
        <meta property="og:url" content={href} />
        <title>{`${title} - Avilio Muñoz V.`}</title>
        <link rel="icon" type="image/svg" href="/favicon.svg" />
        <ClientRouter />
    </head>
    <body class="max-w-2xl mx-auto my-8 px-8 bg-stone-50">
        <header class="border-b border-b-stone-300 mt-4 pb-4 prose">
            <a
                href="/blog"
                class="text-sm text-stone-500 no-underline flex items-center gap-1"
                ><Icon name={"arrow-left"} /> Volver</a
            >
            <h1 class="mt-4">{title}</h1>
            <p>{description}</p>
            <span class="text-sm flex items-center gap-2"
                ><Icon name="calendar-week" size={20} />
                {format(date, "long", "es")}</span
            >
        </header>
        <main class="mt-8 mb-6 prose">
            <slot />
        </main>
        <footer class="border-t border-t-stone-300 mt-10 pt-8 mb-20">
            <h3 class="text-lg font-bold mb-2">¿Cómo citar este artículo?</h3>
            <div class="text-sm text-stone-600">
                <p>Muñoz V., A. ({format(date!, "long", "es")}).</p>
                <p>{title}.</p>
                <a class="text-stone-800 underline" href={href}>{href}</a>
            </div>
            <div
                class="border border-stone-200 rounded-md p-4 mt-6 w-full flex flex-col md:flex-row gap-3 md:gap-6"
            >
                <Image
                    src="/foto-papi-ia-cara.jpg"
                    class="rounded-lg w-3/12"
                    alt="Avatar"
                    width={96}
                    height={96}
                />
                <div class="md:w-9/12">
                    <h4 class="font-bold text-xl mb-2">Avilio Muñoz Vilchez</h4>
                    <div class="text-sm text-stone-700">
                        <p>Economista - Abogado</p>
                        <p>Especialista en Metodología de la Investigación</p>
                        <p>Especialista en Gerencia Tributaria</p>
                        <p>
                            Magister Scientiarum en Catastro y Avalúo
                            Inmobiliario Urbano
                        </p>
                    </div>
                </div>
            </div>
            <h3 class="text-lg font-bold mb-2 mt-8">
                ¿Te ha parecido interesante?
            </h3>
            <div class="text-sm text-stone-600">
                <p>
                    Compártelo con otros estudiantes o amigos que puedan
                    necesitar esta información:
                </p>
                <div class="flex gap-3 mt-4 w-fit text-xs">
                    <!-- Compartir en Twitter -->
                    <a
                        href={`https://twitter.com/intent/tweet?url=${href}&text=${title}`}
                        target="_blank"
                        class="text-blue-400 flex items-center gap-1 border border-blue-400 rounded-md px-3 py-1 hover:bg-blue-50 transition-colors duration-100"
                    >
                        <Icon name="brand-twitter" size={20} />Twitter
                    </a>
                    <!-- Compartir en Linkedin -->
                    <a
                        href={`https://www.linkedin.com/sharing/share-offsite/?url=${href}`}
                        target="_blank"
                        class="text-blue-700 flex items-center gap-1 border border-blue-700 rounded-md px-3 py-1 hover:bg-blue-50 transition-colors duration-100"
                    >
                        <Icon name="brand-linkedin" size={20} />LinkedIn
                    </a>
                    <!-- Compartir en Whatsapp -->
                    <a
                        href={`https://api.whatsapp.com/send?text=${title} ${href}`}
                        target="_blank"
                        class="text-green-500 flex items-center gap-1 border border-green-500 rounded-md px-3 py-1 hover:bg-green-50 transition-colors duration-100"
                    >
                        <Icon name="brand-whatsapp" size={20} />WhatsApp
                    </a>
                </div>
            </div>
            {
                relatedPosts.length > 0 && (
                    <div class="mt-10 border-t border-t-stone-300 pt-2">
                        <h3 class="text-lg font-bold mb-4 mt-8">
                            Artículos relacionados:
                        </h3>
                        <div class="flex flex-col gap-2">
                            {relatedPosts.map((post) => (
                                <PostCard post={post} />
                            ))}
                        </div>
                    </div>
                )
            }
        </footer>
    </body>
</html>
